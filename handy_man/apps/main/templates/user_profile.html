{% extends "base.html" %}
 
<style>
.kv-avatar .file-preview-frame,.kv-avatar .file-preview-frame:hover {
    margin: 0;
    padding: 0;
    border: none;
    box-shadow: none;
    text-align: center;
}
.kv-avatar .file-input {
    display: table-cell;
    max-width: 220px;
}
</style>

{% block content %}
	<div class="container">
        <!--<div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 col-xs-offset-0 col-sm-offset-0 col-md-offset-3 col-lg-offset-3 toppad" >-->
        <!--<form class="form-inline" action="{% url 'user_profile' user.username%}" method="post">
        	{% csrf_token %}-->
          <div class="panel panel-info">
            <div class="panel-heading">
              <h3 class="panel-title">User Profile for <b>{{user_profile.user.username}}</b></h3>
            </div>
            <div class="panel-body">
              	  <!--<div align="center"> <img alt="User Pic" src="{{ STATIC_URL}}gfx/default_avatar_male.jpg" class="img-circle img-responsive"> </div>-->
				  <ul class="nav nav-pills">
				    <li class="active"><a data-toggle="tab" href="#personal">Personal Data</a></li>
				    <li><a data-toggle="tab" href="#documents">Documentation</a></li>
				    <li><a data-toggle="tab" href="#geolocation">GeoLocation</a></li>
				    <li><a data-toggle="tab" href="#current_jobs">Current Jobs</a></li>
				    <li><a data-toggle="tab" href="#completed_jobs">Completed Jobs</a></li>
				  </ul>
				  <div class="tab-content">
				    <div id="personal" class="tab-pane fade in active">
				     <form action="{% url 'user_profile' user_profile.user.username%}" method="post" enctype="multipart/form-data" >
				       {% csrf_token %}
				       <div class="row" style="height:25%;">
				      	  <!--<div align="left"> <img alt="User Pic" src="{{ STATIC_URL}}gfx/default_avatar_male.jpg" class="img-circle img-responsive" style="width:150px;height:150px"> </div>-->
						  <div class="kv-avatar center-block" style="width:180px">
							<div class="file-input">
							<div class="file-preview ">
							    <div class="file-drop-disabled">
								    <div class="file-preview-thumbnails"><div class="file-default-preview"><img src="{{user_profile.avatar_name}}" alt="Your Avatar" style="width:160px" id="avatar_display" name='avatar_display' ></div></div>
								    <div class="clearfix"></div><div class="file-preview-status text-center text-success"></div>
								    <div class="kv-fileinput-error"></div>
							    </div>
							  </div>
							  {% if logged_in_user.username == user_profile.user.username %}
								  <div class="row" align="center">
									  <button type="button" class="btn btn-default" title="Add picture tags" onclick="alert('Call your custom code here.')"><i class="glyphicon glyphicon-tag"></i></button>
									  <button type="button" tabindex="500" title="Cancel or reset changes" class="btn btn-default fileinput-remove fileinput-remove-button"><i class="glyphicon glyphicon-remove"></i></button>
									  <div tabindex="500" class="btn btn-primary btn-file"><i class="glyphicon glyphicon-folder-open"></i>
									     <input id="avatar_image" name="avatar_image" class="" type="file">
									  </div>
								  </div>
							  {% endif %}
							</div>
						 </div>
				      </div>
				      <div class="row">
					      <div class=" col-md-12 col-lg-12 "> 
			                  <table class="table table-user-information">
			                    <tbody>
			                      <tr>
			                        <td>
				                        <label for="first_name">First Name:</label>
				                        <input type="text" id="id_first_name" name="first_name" value="{{user_profile.user.first_name}}" placeholder="First Name" readonly="readonly" style="background-color: #D8D8D8">
									</td>
			                        <td>
			                        	<label for="last_name">Last Name:</label>
			                        	<input type="text" id="id_last_name" name="last_name" value="{{user_profile.user.last_name}}" placeholder="Last Name" readonly="readonly" style="background-color: #D8D8D8">
			                      	</td>
			                      </tr>
			                      <tr>
			                        <td>
			                        	<label for="dob">Date of Birth:</label>
			                        	<input type="date" id="id_dob" name="dob" value="{{user_profile.formated_dob}}" placeholder="Date Of Birth" readonly="readonly" style="background-color: #D8D8D8">
				                     </td>
				                     <td>
				                        <label for="email">Contact Email:</label>
				                        <input type="text" id="id_email" name="email" value="{{user_profile.user.email}}" placeholder="Contact Email" readonly="readonly" style="background-color: #D8D8D8">
			                        </td>
			                      </tr>
			                      <tr>
			                        <td>
				                        <label for="contact_number">Mobile Number:</label>
				                        <input type="text" id="id_mobile" name="mobile" value="{{user_profile.mobile}}" placeholder="Mobile Number" readonly="readonly" style="background-color: #D8D8D8">
			                        </td>
			                        <td>
			                        	<label for="alter_contact">Alternative Number:</label>
			                        	<input type="text" id="id_alter_contact" name="alter_contact" value="{{user_profile.alter_contact}}" placeholder="Alternative Number" readonly="readonly" style="background-color: #D8D8D8">
			                        </td>
			                      </tr>
			                      {% if logged_in_user.username == user_profile.user.username %}
				                      <tr>
				                        <td><a href=>Change Password</a><br></td>
				                      </tr> 
				                  {% endif %}
			                    </tbody>
			                  </table>
			               </div>
			            </div>
			            {% if logged_in_user.username == user_profile.user.username %}
				            <div class="row">
				            	<div class=" col-md-6 col-lg-6 " align="left"> 
				                  <div class="form-group">
				                  	<button class="btn btn-primary" value="submit" name="user" id="edit_profile">Edit</button>
				                  </div>
		                		</div>
				            	<div class=" col-md-6 col-lg-6 " align="right"> 
				                  <div class="form-group">
				                  	<button class="btn btn-primary" type="submit" value="submit" name="user" id="user">Submit</button>
				                  </div>
		                		</div>
		                	</div>
	                	{% endif %}
	                  </form>
				    </div>
				    <div id="documents" class="tab-pane fade">
				      <form action="{% url 'user_profile_documents' user_profile.user.username%}" method="post" enctype="multipart/form-data" >
				       {% csrf_token %}
				    	<div class="row">
				    		<div class=" col-md-12 col-lg-12 ">
								<label class="control-label">Documents</label>
								<div class="file-input">
									<div class="file-preview">
									    <div class="close fileinput-remove">×</div>
									    <div class="file-drop-disabled">
									    	<div class="file-preview-thumbnails">
									    		<div class="file-preview-frame file-preview-initial" id="preview-1460010531223-init_0" data-fileindex="init_0">
									    			<iframe src="{{user_profile.document_urls.0}}" style="width:124px; height:174px" frameborder="0" id='document_display_0'></iframe>
											   		<!--<img src="" class="file-preview-image" alt="" title="" style="width:124px;height:174px" id='document_display_0'>--> 
												</div>
												<div class="file-preview-frame file-preview-initial" id="preview-1460010531223-init_1" data-fileindex="init_1">
													<!--<img src="" class="file-preview-image" alt="" title="" style="width:124px;height:174px" id='document_display_1'>-->
													<iframe src="{{user_profile.document_urls.1}}" style="width:124px; height:174px" frameborder="0" id='document_display_1'></iframe> 
												</div>
												<div class="file-preview-frame file-preview-initial" id="preview-1460010531223-init_2" data-fileindex="init_2">
													<iframe src="{{user_profile.document_urls.2}}" style="width:124px; height:174px" frameborder="0" id='document_display_2'></iframe>
													<!--<img src="" class="file-preview-image" alt="" title="" style="width:124px;height:174px" id='document_display_2'>--> 
												</div>
											    <div class="clearfix"></div>
												<div class="file-preview-status text-center text-success"></div>
												<div style="display: none;" class="kv-fileinput-error file-error-message"></div>
									    	</div>
										</div>
										<div class="kv-upload-progress hide">
											<div class="progress">
											    <div class="progress-bar progress-bar-success progress-bar-striped active" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width:0%;">
											        0%
											     </div>
											</div>
										</div>
								</div>
							</div>
						</div>
					  </div>
					  {% if logged_in_user.username == user_profile.user.username %}
						  <div class="row">
								<div class=" col-md-12 col-lg-12 ">
									<div class="input-group ">
									   <div tabindex="500" class="form-control file-caption  kv-fileinput-caption">
									   		<div title="upload documents" class="file-caption-name"><span class="glyphicon glyphicon-file kv-caption-icon"></span>upload documents</div>
										</div>
									   <div class="input-group-btn">
									       <button type="button" tabindex="500" title="Clear selected files" class="btn btn-default fileinput-remove fileinput-remove-button" id="remove_document"><i class="glyphicon glyphicon-trash"></i> <span class="hidden-xs">Remove</span></button>
									       <button type="button" tabindex="500" title="Abort ongoing upload" class="btn btn-default hide fileinput-cancel fileinput-cancel-button"><i class="glyphicon glyphicon-ban-circle"></i> <span class="hidden-xs">Cancel</span></button>
									       <button type="submit" tabindex="500" title="Upload selected files" class="btn btn-default fileinput-upload fileinput-upload-button"><i class="glyphicon glyphicon-upload"></i> <span class="hidden-xs">Upload</span></button>
									       <div tabindex="500" class="btn btn-primary btn-file">
									       		<i class="glyphicon glyphicon-folder-open"></i>&nbsp;
									       		 <span class="hidden-xs">Browse …</span>
									       		<input id="input-24" name="input-24" multiple class="file-loading" type="file"	>
									       </div>
									   </div>
									</div>
								</div>
						    </div>
						 {% endif %}
					 </form>
				  </div>
			      <div id="geolocation" class="tab-pane fade">
			      	<div id="googleMap" style="width:600px;height:380px;"></div>
			      </div>
			      <div id="current_jobs" class="tab-pane fade">
			      	<p>Sed ut perspiciatis unde omnis iste natus error sit voluptatem accusantium doloremque laudantium, totam rem aperiam.</p>
			      </div>
			      <div id="completed_jobs" class="tab-pane fade">
			      	<p>Sed ut perspiciatis unde omnis iste natus error sit voluptatem accusantium doloremque laudantium, totam rem aperiam.</p>
			      </div>
              </div>
            </div>
                 <!-- <div class="panel-footer">
                        <a data-original-title="Broadcast Message" data-toggle="tooltip" type="button" class="btn btn-sm btn-primary"><i class="glyphicon glyphicon-envelope"></i></a>
                        <span class="pull-right">
                            <a href="edit.html" data-original-title="Edit this user" data-toggle="tooltip" type="button" class="btn btn-sm btn-warning"><i class="glyphicon glyphicon-edit"></i></a>
                            <a data-original-title="Remove this user" data-toggle="tooltip" type="button" class="btn btn-sm btn-danger"><i class="glyphicon glyphicon-remove"></i></a>
                        </span>
                    </div> -->
          </div>
          <!--</form>-->
        <!--</div>-->
      </div>
      <script>
      		//Changes user profile photo
      		$(document).ready( function() {
				$("#avatar_image").change(function(event) {
					var selectedFile = event.target.files[0];
					var reader = new FileReader();
					var imgtag = $("#avatar_display")
					imgtag.title = selectedFile.name;
					reader.onload = function(event) {
					    imgtag.attr('src', event.target.result);
					}
					reader.readAsDataURL(selectedFile);
					  //$( "#avatar_image" ).attr('src', $( this ).val());
				});
	      		//Uploads supporting documents agains user profile
				$("#input-24").change(function(event) {
					var selectedFiles = event.target.files;
					var reader = new FileReader();
					var count = 0;
					$("iframe[id^=document_display]").each(function(index) {
						if ($(this).attr('src') == ''){
							var imgtag = $(this);
							if(count < selectedFiles.length){
								imgtag.title = selectedFiles[count].name;
								reader.onload = function(event) {
									imgtag.attr('src', event.target.result);
								}
								reader.readAsDataURL(selectedFiles[count]);
								count++;
								reader = new FileReader();
							}
						}
					});
					count = 0;
					return false;		
				});
				//When Edit button is clicked, make inputs ready to accept data.
				$("#edit_profile").click(function(event) {
					$("input[id^=id_]").each(function(index) {
						$(this).removeAttr("readonly");
						$(this).removeAttr("style");
					});
					return false;
				});
				//Remove all uploaded documents
				$("#remove_document").click(function(event) {
					$("iframe[id^=document_display]").each(function(index) {
						$(this).attr('src', '');
					});
					return false;
				});
				//Open document in new tab on click
				$("div[id^=preview-]").each(function(index) {
					$(this).click(function() {
						alert('INSIDE');
						//window.open("http://www.google.com", "_blank");
					});
					//return false;
				});	
      		});
	 </script>
{% endblock %}


